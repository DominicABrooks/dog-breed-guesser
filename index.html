<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Guess the Dog Breed</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        padding: 10px;
        background: #fafafa;
      }
      img {
        max-width: 100%;
        height: auto;
        border-radius: 12px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        margin-bottom: 20px;
      }
      input,
      button {
        padding: 14px;
        font-size: 1.1rem;
        border-radius: 5px;
        border: 1px solid #ccc;
        margin: 8px 0;
        width: 80%;
        box-sizing: border-box;
      }
      #feedback {
        font-weight: bold;
        margin-top: 15px;
      }
      .dropdown-item {
        font-size: 1.1rem;
        padding: 14px;
      }
      @media (max-width: 500px) {
        .streak {
          font-size: 1rem !important;
          top: 10px !important;
          right: 10px !important;
        }
        div[style*="inline-block"] {
          width: 100% !important;
          max-width: 100% !important;
        }
      }
    </style>
  </head>
  <body>
    <div
      class="streak"
      style="
        position: absolute;
        top: 20px;
        right: 30px;
        font-size: 1.2rem;
        font-weight: bold;
        color: #1976d2;
      "
      id="streak"
    >
      Streak: 0
    </div>
    <h1>üê∂ Guess the Dog Breed</h1>
    <img id="dogImage" src="" alt="Random Dog" /><br />
    <div
      style="
        position: relative;
        display: inline-block;
        width: 300px;
        max-width: 100%;
      "
    >
      <input
        id="guessInput"
        type="text"
        placeholder="Enter breed"
        autocomplete="off"
        style="width: 90%"
      />
      <div
        id="breedDropdown"
        style="
          display: none;
          position: absolute;
          top: 100%;
          left: 0;
          width: 100%;
          background: #fff;
          border: 1px solid #ccc;
          border-top: none;
          max-height: 180px;
          overflow-y: auto;
          z-index: 10;
        "
      ></div>
    </div>
    <div id="feedback"></div>
    <button onclick="checkGuess()">Guess</button>
    <button onclick="nextDog()">Next Dog</button>

    <script>
      let currentBreed = "";
      let breedList = [];
      let filteredBreeds = [];
      let selectedIndex = -1;
      let streak = 0;
      const guessInput = document.getElementById("guessInput");
      const breedDropdown = document.getElementById("breedDropdown");
      const streakDiv = document.getElementById("streak");

      // Fetch breed list from API
      fetch("https://dog.ceo/api/breeds/list/all")
        .then((res) => res.json())
        .then((data) => {
          breedList = getAllBreedsList(data.message);
        });

      function showDropdown(items) {
        if (!items.length) {
          breedDropdown.style.display = "none";
          return;
        }
        breedDropdown.innerHTML = items
          .map(
            (breed, i) =>
              `<div class="dropdown-item${
                i === selectedIndex ? " active" : ""
              }" data-index="${i}" style="padding:8px;cursor:pointer;${
                i === selectedIndex ? "background:#f0f0f0;" : ""
              }">${breed}</div>`
          )
          .join("");
        breedDropdown.style.display = "block";
      }

      function getAllBreedsList(breedData) {
        const breeds = [];
        for (const [main, subs] of Object.entries(breedData)) {
          if (subs.length === 0) {
            breeds.push(main);
          } else {
            breeds.push(main);
            subs.forEach((sub) => breeds.push(`${sub} ${main}`));
          }
        }
        console.log(breeds)
        return breeds;
      }

      function filterBreeds(value) {
        if (!value) return breedList;
        return breedList.filter((b) =>
          b.toLowerCase().includes(value.toLowerCase())
        );
      }

      guessInput.addEventListener("input", (e) => {
        const value = e.target.value;
        filteredBreeds = filterBreeds(value);
        selectedIndex = -1;
        showDropdown(filteredBreeds);
        document.getElementById("feedback").textContent = "";
      });

      guessInput.addEventListener("keydown", (e) => {
        if (breedDropdown.style.display === "none") return;
        if (e.key === "ArrowDown") {
          selectedIndex = (selectedIndex + 1) % filteredBreeds.length;
          showDropdown(filteredBreeds);
          e.preventDefault();
        } else if (e.key === "ArrowUp") {
          selectedIndex =
            (selectedIndex - 1 + filteredBreeds.length) % filteredBreeds.length;
          showDropdown(filteredBreeds);
          e.preventDefault();
        } else if (e.key === "Enter") {
          if (selectedIndex >= 0 && filteredBreeds[selectedIndex]) {
            guessInput.value = filteredBreeds[selectedIndex];
            breedDropdown.style.display = "none";
            e.preventDefault();
          }
        }
      });

      breedDropdown.addEventListener("mousedown", (e) => {
        if (e.target.classList.contains("dropdown-item")) {
          guessInput.value = filteredBreeds[parseInt(e.target.dataset.index)];
          breedDropdown.style.display = "none";
          document.getElementById("feedback").textContent = "";
        }
      });

      document.addEventListener("click", (e) => {
        if (!breedDropdown.contains(e.target) && e.target !== guessInput) {
          breedDropdown.style.display = "none";
        }
      });

      async function loadDog() {
        document.getElementById("feedback").textContent = "";
        guessInput.value = "";
        breedDropdown.style.display = "none";

        const res = await fetch("https://dog.ceo/api/breeds/image/random");
        const data = await res.json();
        const imageUrl = data.message;

        document.getElementById("dogImage").src = imageUrl;

        // Extract breed from URL
        const parts = imageUrl.split("/");
        const breedIndex = parts.indexOf("breeds") + 1;
        let breedName = parts[breedIndex];

        // Handle sub-breeds (e.g. bulldog-boston ‚Üí "boston bulldog")
        if (breedName.includes("-")) {
          let [main, sub] = breedName.split("-");
          breedName = sub + " " + main;
        }

        currentBreed = breedName.toLowerCase();
      }

      function checkGuess() {
        const guess = guessInput.value.trim().toLowerCase();
        const feedback = document.getElementById("feedback");

        // Validate breed
        if (!breedList.map((b) => b.toLowerCase()).includes(guess)) {
          feedback.textContent = "Please select a valid breed from the list.";
          feedback.style.color = "orange";
          return;
        }

        if (!guess) {
          feedback.textContent = "Please enter a guess!";
          feedback.style.color = "orange";
          return;
        }

        // Split breed/sub-breed
        const guessParts = guess.split(" ");
        const breedParts = currentBreed.split(" ");

        // If both are main breed (no sub-breed)
        if (
          guessParts.length === 1 &&
          breedParts.length === 1 &&
          guessParts[0] === breedParts[0]
        ) {
          feedback.textContent = "‚úÖ Correct! It‚Äôs a " + currentBreed;
          feedback.style.color = "green";
          streak++;
          streakDiv.textContent = "Streak: " + streak;
          return;
        }

        // If guess is main breed and answer is sub-breed of that main breed
        if (
          guessParts.length === 1 &&
          breedParts.length === 2 &&
          guessParts[0] === breedParts[1]
        ) {
          feedback.textContent = "‚úÖ Correct! It‚Äôs a " + currentBreed;
          feedback.style.color = "green";
          streak++;
          streakDiv.textContent = "Streak: " + streak;
          return;
        }

        // If both are sub-breed and main breed
        if (guessParts.length === 2 && breedParts.length === 2) {
          if (
            guessParts[0] === breedParts[0] &&
            guessParts[1] === breedParts[1]
          ) {
            feedback.textContent = "‚úÖ Correct! It‚Äôs a " + currentBreed;
            feedback.style.color = "green";
            streak++;
            streakDiv.textContent = "Streak: " + streak;
            return;
          } else if (guessParts[1] === breedParts[1]) {
            feedback.textContent = "‚ùå Incorrect. It‚Äôs a " + currentBreed;
            feedback.style.color = "red";
            streak = 0;
            streakDiv.textContent = "Streak: " + streak;
            return;
          }
        }

        // If guess is sub-breed and answer is main breed
        if (
          guessParts.length === 2 &&
          breedParts.length === 1 &&
          guessParts[1] === breedParts[0]
        ) {
          feedback.textContent = "‚úÖ Correct! It‚Äôs a " + currentBreed;
          feedback.style.color = "green";
          streak++;
          streakDiv.textContent = "Streak: " + streak;
          return;
        }

        // Otherwise fail
        feedback.textContent = "‚ùå Incorrect. It‚Äôs a " + currentBreed;
        feedback.style.color = "red";
        streak = 0;
        streakDiv.textContent = "Streak: " + streak;
      }

      function nextDog() {
        loadDog();
      }

      // Load first dog on page load
      loadDog();
    </script>
  </body>
</html>
